(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const fe=(e,t)=>e===t,H={equals:fe};let ee=re;const x=1,_=2,te={owned:null,cleanups:null,context:null,owner:null};var h=null;let M=null,f=null,p=null,y=null,k=0;function pe(e,t){const n=f,r=h,s=e.length===0,i=s?te:{owned:null,cleanups:null,context:null,owner:t===void 0?r:t},o=s?e:()=>e(()=>$(()=>R(i)));h=i,f=null;try{return A(o,!0)}finally{f=n,h=r}}function E(e,t){t=t?Object.assign({},H,t):H;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),ne(n,s));return[de.bind(n),r]}function N(e,t,n){const r=se(e,t,!1,x);F(r)}function he(e,t,n){ee=me;const r=se(e,t,!1,x);(!n||!n.render)&&(r.user=!0),y?y.push(r):F(r)}function $(e){if(f===null)return e();const t=f;f=null;try{return e()}finally{f=t}}function de(){if(this.sources&&this.state)if(this.state===x)F(this);else{const e=p;p=null,A(()=>j(this),!1),p=e}if(f){const e=this.observers?this.observers.length:0;f.sources?(f.sources.push(this),f.sourceSlots.push(e)):(f.sources=[this],f.sourceSlots=[e]),this.observers?(this.observers.push(f),this.observerSlots.push(f.sources.length-1)):(this.observers=[f],this.observerSlots=[f.sources.length-1])}return this.value}function ne(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&A(()=>{for(let s=0;s<e.observers.length;s+=1){const i=e.observers[s],o=M&&M.running;o&&M.disposed.has(i),(o?!i.tState:!i.state)&&(i.pure?p.push(i):y.push(i),i.observers&&ie(i)),o||(i.state=x)}if(p.length>1e6)throw p=[],new Error},!1)),t}function F(e){if(!e.fn)return;R(e);const t=h,n=f,r=k;f=h=e,ge(e,e.value,r),f=n,h=t}function ge(e,t,n){let r;try{r=e.fn(t)}catch(s){return e.pure&&(e.state=x,e.owned&&e.owned.forEach(R),e.owned=null),e.updatedAt=n+1,oe(s)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?ne(e,r):e.value=r,e.updatedAt=n)}function se(e,t,n,r=x,s){const i={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:h,context:null,pure:n};return h===null||h!==te&&(h.owned?h.owned.push(i):h.owned=[i]),i}function B(e){if(e.state===0)return;if(e.state===_)return j(e);if(e.suspense&&$(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<k);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===x)F(e);else if(e.state===_){const r=p;p=null,A(()=>j(e,t[0]),!1),p=r}}function A(e,t){if(p)return e();let n=!1;t||(p=[]),y?n=!0:y=[],k++;try{const r=e();return ye(n),r}catch(r){n||(y=null),p=null,oe(r)}}function ye(e){if(p&&(re(p),p=null),e)return;const t=y;y=null,t.length&&A(()=>ee(t),!1)}function re(e){for(let t=0;t<e.length;t++)B(e[t])}function me(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:B(r)}for(t=0;t<n;t++)B(e[t])}function j(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const s=r.state;s===x?r!==t&&(!r.updatedAt||r.updatedAt<k)&&B(r):s===_&&j(r,t)}}}function ie(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=_,n.pure?p.push(n):y.push(n),n.observers&&ie(n))}}function R(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),o=n.observerSlots.pop();r<s.length&&(i.sourceSlots[o]=r,s[r]=i,n.observerSlots[r]=o)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)R(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function xe(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function oe(e,t=h){throw xe(e)}function le(e,t){return $(()=>e(t||{}))}function we(e,t,n){let r=n.length,s=t.length,i=r,o=0,l=0,u=t[s-1].nextSibling,a=null;for(;o<s||l<i;){if(t[o]===n[l]){o++,l++;continue}for(;t[s-1]===n[i-1];)s--,i--;if(s===o){const c=i<r?l?n[l-1].nextSibling:n[i-l]:u;for(;l<i;)e.insertBefore(n[l++],c)}else if(i===l)for(;o<s;)(!a||!a.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[i-1]&&n[l]===t[s-1]){const c=t[--s].nextSibling;e.insertBefore(n[l++],t[o++].nextSibling),e.insertBefore(n[--i],c),t[s]=n[i]}else{if(!a){a=new Map;let g=l;for(;g<i;)a.set(n[g],g++)}const c=a.get(t[o]);if(c!=null)if(l<c&&c<i){let g=o,w=1,I;for(;++g<s&&g<i&&!((I=a.get(t[g]))==null||I!==c+w);)w++;if(w>c-l){const S=t[o];for(;l<c;)e.insertBefore(n[l++],S)}else e.replaceChild(n[l++],t[o++])}else o++;else t[o++].remove()}}}const K="_$DX_DELEGATE";function Se(e,t,n,r={}){let s;return pe(i=>{s=i,t===document?e():T(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{s(),t.textContent=""}}function O(e,t,n){let r;const s=()=>{const o=document.createElement("template");return o.innerHTML=e,n?o.content.firstChild.firstChild:o.content.firstChild},i=t?()=>$(()=>document.importNode(r||(r=s()),!0)):()=>(r||(r=s())).cloneNode(!0);return i.cloneNode=i,i}function ve(e,t=window.document){const n=t[K]||(t[K]=new Set);for(let r=0,s=e.length;r<s;r++){const i=e[r];n.has(i)||(n.add(i),t.addEventListener(i,Ce))}}function be(e,t,n){return $(()=>e(t,n))}function T(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return D(e,t,r,n);N(s=>D(e,t(),s,n),r)}function Ce(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}});n;){const r=n[t];if(r&&!n.disabled){const s=n[`${t}Data`];if(s!==void 0?r.call(n,s,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function D(e,t,n,r,s){for(;typeof n=="function";)n=n();if(t===n)return n;const i=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,i==="string"||i==="number")if(i==="number"&&(t=t.toString()),o){let l=n[0];l&&l.nodeType===3?l.data=t:l=document.createTextNode(t),n=b(e,n,r,l)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t;else if(t==null||i==="boolean")n=b(e,n,r);else{if(i==="function")return N(()=>{let l=t();for(;typeof l=="function";)l=l();n=D(e,l,n,r)}),()=>n;if(Array.isArray(t)){const l=[],u=n&&Array.isArray(n);if(V(l,t,n,s))return N(()=>n=D(e,l,n,r,!0)),()=>n;if(l.length===0){if(n=b(e,n,r),o)return n}else u?n.length===0?Q(e,l,r):we(e,n,l):(n&&b(e),Q(e,l));n=l}else if(t.nodeType){if(Array.isArray(n)){if(o)return n=b(e,n,r,t);b(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}else console.warn("Unrecognized value. Skipped inserting",t)}return n}function V(e,t,n,r){let s=!1;for(let i=0,o=t.length;i<o;i++){let l=t[i],u=n&&n[i],a;if(!(l==null||l===!0||l===!1))if((a=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))s=V(e,l,u)||s;else if(a==="function")if(r){for(;typeof l=="function";)l=l();s=V(e,Array.isArray(l)?l:[l],Array.isArray(u)?u:[u])||s}else e.push(l),s=!0;else{const c=String(l);u&&u.nodeType===3&&u.data===c?e.push(u):e.push(document.createTextNode(c))}}return s}function Q(e,t,n=null){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function b(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let i=!1;for(let o=t.length-1;o>=0;o--){const l=t[o];if(s!==l){const u=l.parentNode===e;!i&&!o?u?e.replaceChild(s,l):e.insertBefore(s,n):u&&l.remove()}else i=!0}}else e.insertBefore(s,n);return[s]}const W=/=[^]*$/g;function ue(e,t,n){if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(let r=0;r<e.length;r++)if(!ue(e[r],t[r],n))return!1;return!0}return typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<n:!1}function ae(e){switch(e.type){case"number":return e.value.toString();case"color":return`\\operatorname{rgb}\\left(${e.value[0]},${e.value[1]},${e.value[2]}\\right)`;case"point":return`\\left(${e.value[0]}, ${e.value[1]}\\right)`;case"polygon":return`\\operatorname{polygon}\\left(${e.value.map(t=>`\\left(${t[0]}, ${t[1]}\\right)`).join(",")}\\right)`;case"number-list":return`\\left[${e.value.join(",")}\\right]`;case"point-list":return`\\left[${e.value.map(t=>`\\left(${t[0]},${t[1]}\\right)`)}\\right]`;case"color-list":return`\\left[${e.value.map(t=>`\\operatorname{rgb}\\left(${t[0]},${t[1]},${t[2]}\\right)`)}\\right]`;case"polygon-list":return`\\left[${e.value.map(t=>ae({type:"polygon",value:t})).join(",")}\\right]`}}async function z(e,t){await e.resetGraph();const n=await e.getState();let r=0;for(const i of n.expressions.list){if(r>=t.input.length)break;if(i.type!=="expression"||!i.latex||!i.latex.match(W))continue;console.log(t,r);let l=i.latex.replace(W,"")+"="+ae(t.input[r]);await e.setExpressionLatex(i.id,l),r++}if(t.useTicker)for(;await e.doTickerStep(););const s={};if(t.expectedOutput){s.outputExpressions=[];const i=t.expectedOutput.type==="data"?t.expectedOutput.data.length:t.expectedOutput.thresholds.length;await e.getState(),n.expressions.list.reverse();let o=0;for(const l of n.expressions.list){if(o>=i)break;if(l.type!=="expression"||!l.latex)continue;const u=await e.getExpressionValue(l.id);u&&(s.outputExpressions.push(u),o++)}}return t.screenshot&&(s.outputScreenshot=await e.getScreenshotBitmap({xmin:t.screenshot.minX,xmax:t.screenshot.maxX,ymin:t.screenshot.minY,ymax:t.screenshot.maxY,widthInPixels:t.screenshot.widthInPixels,heightInPixels:t.screenshot.heightInPixels})),console.log("testcase output",s),s}async function Ee(e,t){const n={input:t.input,useTicker:t.useTicker};t.expectedOutput?.type==="reference"&&(n.expectedOutput=t.expectedOutput),t.screenshot?.expectedOutput.type==="reference"&&(n.screenshot=t.screenshot);let r;if(n.expectedOutput||n.screenshot){const u=await e.referenceGraphs(t.referenceGraphLink);if(!u)return console.warn("Test uses references without a reference graph!"),!1;r=await z(u,n)}let s;const i=t.expectedOutput;r?.outputExpressions&&i?.type==="reference"?s={type:"data",data:r.outputExpressions.map((u,a)=>({expectedValue:u,threshold:i.thresholds[a]??-1}))}:s=t.expectedOutput;let o;r?.outputScreenshot?o=r.outputScreenshot:t.screenshot?.expectedOutput.type==="uri"&&(o=await e.testGraph.uriToBitmap(t.screenshot.expectedOutput.value));const l=await z(e.testGraph,t);if(l.outputExpressions&&s){if(l.outputExpressions.length!=s.data.length)return!1;for(let u=0;u<s.data.length;u++)if(!ue(l.outputExpressions[u].value,s.data[u].expectedValue.value,s.data[u].threshold))return!1}if(l.outputScreenshot&&o){if(l.outputScreenshot.length!=o.length)return!1;let u=0;for(let a=0;a<o.length;a++)u+=Math.abs(l.outputScreenshot[a]-o[a]);if(u/(o.length*256)>(t.screenshot?.invalidSubmissionThreshold??-1))return!1}return!0}async function Te(e,t){let n=0,r=[];for(const s of t.testCases)await Ee(e,s)||r.push(n),n++;return r}async function q(e,t){let n=0,r=e.controller.dispatcher.register(s=>{s.type==="on-evaluator-changes"&&n++});return new Promise((s,i)=>{const o=setInterval(()=>{n>=t&&(e.controller.dispatcher.unregister(r),clearInterval(o),s())})})}function U(e){let t=0,n=e.getState();async function r(s){const i=await(await fetch(s)).blob(),o=await createImageBitmap(i),u=new OffscreenCanvas(o.width,o.height).getContext("2d");return u?.drawImage(o,0,0),Array.from(u?.getImageData(0,0,o.width,o.height).data??[])}return{async doTickerStep(){let s=0,i=e.controller.dispatcher.register(o=>{o.type==="on-evaluator-changes"&&s++});return e.controller.dispatch({type:"tick-ticker",time:t++}),new Promise((o,l)=>{const u=setInterval(()=>{const a=s>=2,c=e.controller.getTicker().formula.handler!=="maybe-valid";!c&&!c||(c||a)&&(o(!c),clearInterval(u),e.controller.dispatcher.unregister(i))})})},async getState(){return e.getState()},async setExpressionLatex(s,i){e.setExpression({id:s,latex:i}),console.log("setexprlatex"),await q(e,1)},async getScreenshotBitmap(s){const i=await new Promise((o,l)=>{e.asyncScreenshot({mathBounds:{left:s.xmin,right:s.xmax,top:s.ymax,bottom:s.ymin},width:s.widthInPixels,height:s.heightInPixels},u=>{o(u)})});return r(i)},uriToBitmap:r,async resetGraph(){e.setState(n),console.log("resetgraph"),await q(e,1)},async getExpressionValue(s){const i=e.controller.getItemModel(s)?.formula?.typed_constant_value;if(!i)return;const o={1:"number",3:"point",14:"color",16:"polygon",7:"number-list",9:"point-list",15:"color-list",17:"polygon-list"}[i.valueType];if(o)return{type:o,value:i.value}}}}const $e=O("<div><button>Run Test Suite</button><label>Test This Graph: </label><input><div></div><h2> out of <!> Tests Failed:</h2><code>");async function Z(e){return await(await fetch(e,{headers:{Accept:"application/json"}})).json()}function Ae(e){const[t,n]=E("https://www.desmos.com/calculator/bjdtsz0sbi"),[r,s]=E(),[i,o]=E(new Map),[l,u]=E([]),a=async()=>r()?.setState?.((await Z(t())).state);he(()=>{a()});let c;return(()=>{const g=$e(),w=g.firstChild,I=w.nextSibling,S=I.nextSibling,P=S.nextSibling,G=P.nextSibling,X=G.firstChild,Y=X.nextSibling;Y.nextSibling;const ce=G.nextSibling;return w.$$click=async()=>{for(const[d,m]of i().entries())m.graph.destroy(),m.el.parentElement.removeChild(m.el);await a(),o(new Map);const v=Te({referenceGraphs:async d=>{const m=i().get(d);if(m)return U(m.graph);const J=await Z(d);if(!J)return;const C=document.createElement("div");C.style.height="400px",C.style.width="400px",c.appendChild(C);const L=Desmos.GraphingCalculator(C,{});return L.setState(J.state),await q(L,1),o(new Map([...i(),[d,{graph:L,el:C}]])),U(L)},testGraph:U(r())},e.testSuite());u((await v).map(d=>e.testSuite().testCases[d]))},S.$$input=v=>{n(v.target.value)},S.style.setProperty("width","400px"),be(v=>{setTimeout(()=>{c=v;const d=document.createElement("div");d.style.height="400px",d.style.width="400px",v.appendChild(d),console.log(d);const m=Desmos.GraphingCalculator(d,{});s(m),a()})},P),P.style.setProperty("display","flex"),P.style.setProperty("flex-wrap","wrap"),T(G,()=>l().length,X),T(G,()=>e.testSuite().testCases.length,Y),T(ce,()=>JSON.stringify(l())),N(()=>S.value=t()),g})()}ve(["click","input"]);const Oe=O("<h1>Desmos Test Runner"),Ie=O("<h2>Test Suite"),Pe=O("<textarea>"),Ge=O("<h2>Test Runner"),Le={testCases:[-10,-8,-6,-4,-2,1,2,4,6,8,10].map(e=>({referenceGraphLink:"https://www.desmos.com/calculator/6yampiamhp",useTicker:!1,input:[{type:"number",value:e}],screenshot:{minX:-10,maxX:10,minY:-10,maxY:10,widthInPixels:512,heightInPixels:512,invalidSubmissionThreshold:.001,expectedOutput:{type:"reference"}}}))},_e=()=>{const[e,t]=E(JSON.stringify(Le));return[Oe(),Ie(),(()=>{const n=Pe();return n.addEventListener("change",r=>{t(r.target.value)}),T(n,e),n})(),Ge(),le(Ae,{testSuite:()=>JSON.parse(e())})]},Ne=document.getElementById("root");Se(()=>le(_e,{}),Ne);
